---
title: "Houston Restaurant Weeks, 2019"
resource_files:
- hrw_menus.csv
runtime: shiny
output:
  flexdashboard::flex_dashboard:
    orientation: rows
    social: menu
    theme: cerulean
    vertical_layout: scroll
---

```{r}
knitr::opts_chunk$set(fig.width=8, fig.height=5, echo=FALSE, warning=FALSE, message=FALSE, error = FALSE, fig.pos='center', cache=FALSE, progress=TRUE)

options(shiny.error =  function() {
    stop("")
  },
  shiny.reactlog = TRUE,
  shiny.sanitize.errors = FALSE)

# Get packages ------------------------------------------------------------
library(tidyverse)
library(shiny)
library(flexdashboard)
library(DT)
library(leaflet)
```


```{r}
all_menus <- read_csv("hrw_menus.csv") %>% 
    mutate(url = paste0("<a href='",url,"'>",name,"</a>"),
           content = paste(url, address, phone, sep = "<br/>")) 
```






```{r}
filt_menus <- reactive({
  if(input$name == "All restaurants"){
    all_menus
  } else{
    all_menus %>% 
      dplyr::filter(name %in% input$name) 
  }
})

```

Home
=================================================================
Column {.sidebar}
-----------------------------------------------------------------------
```{r filters}
selectizeInput("name", 
               "Restaurant Name",         
               choices = c("All restaurants", unique(all_menus$name)),
               multiple = TRUE,
               width = '100%',
               selected = "All restaurants")

```

row
---------------------------------------------------------------
### Houston Restaurant Weeks headcount

```{r}
renderValueBox({
    valueBox(value = n_distinct(all_menus$url), 
           caption = "<b># of Restaurants offering HRW and parsed</b>", 
           icon = "fa-cutlery", 
           color = "#77AF43")

})
```

Column {data-height=800, data-width=800, style="height:100pc;" .tabset .tabset-fade}
-----------------------------------------------------------------------

### HRW maps
```{r geolocate}
renderLeaflet({
  filt_menus() %>%
    distinct(latitude, longitude, content) %>% 
    leaflet(., options = leafletOptions(
                zoomControl = TRUE)) %>%
    addTiles() %>%
    addMarkers(lat = ~latitude, lng = ~longitude, 
               popup = ~content) 
})
  
    
```

### Table view of HRW
```{r}
DT::renderDataTable(filt_menus() %>% 
                      select(-latitude, -longitude, -name, -content, -meal_idx), 
                    extensions = "Responsive", 
                    escape = FALSE,
                    filter = list(position = 'top', clear = TRUE, plain = FALSE),
                    options = list(
                      columnDefs = list(list(className = 'dt-center', targets = 5)),
                      searchHighlight = TRUE,
                                    pageLength = 20,
                                    fixedColumns = TRUE,
                                    autoWidth = TRUE,
                                    ordering = TRUE))

```

